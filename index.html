<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pro Trading Signal Dashboard</title>

<style>
body{
  background:#020617;
  color:#fff;
  font-family:Arial;
}
.box{
  background:#0f172a;
  padding:20px;
  margin:15px auto;
  width:380px;
  border-radius:14px;
}
h2,h3,h4{margin:6px 0}
.buy{color:#22c55e;font-weight:bold}
.sell{color:#ef4444;font-weight:bold}
.wait{color:#eab308;font-weight:bold}
.card{
  border:1px solid #334155;
  border-radius:8px;
  padding:8px;
  margin-bottom:6px;
}
small{color:#94a3b8}
</style>
</head>

<body>

<div class="box">
  <h2>ðŸ“ˆ Pro Trading Dashboard</h2>

  <select id="stock" style="width:100%;padding:8px">
    <option value="RELIANCE.BSE">RELIANCE</option>
    <option value="TCS.BSE">TCS</option>
    <option value="INFY.BSE">INFY</option>
  </select>

  <button onclick="analyze()" style="width:100%;padding:10px;margin-top:8px">
    Analyze
  </button>

  <h3 id="signal" class="wait">WAIT</h3>
  <small id="info"></small>

  <div id="performance"></div>
  <div id="history"></div>
</div>

<div class="box">
  <div id="scanner"></div>
</div>

<div class="box">
  <div id="indexScanner"></div>
</div>

<script>
// ================= SETTINGS =================
const API_KEY = "9609WG3E820V16TS";
const TARGET_PCT = 0.005;
const SL_PCT = 0.003;

// ================= DATA =================
let totalTrades = 0;
let winTrades = 0;
let history = [];
let activeTrade = null;

// ================= LISTS =================
const STOCKS = [
 {name:"RELIANCE",symbol:"RELIANCE.BSE"},
 {name:"TCS",symbol:"TCS.BSE"},
 {name:"INFY",symbol:"INFY.BSE"},
 {name:"HDFCBANK",symbol:"HDFCBANK.BSE"}
];

const INDEXES = [
 {name:"NIFTY 50",symbol:"NIFTYBEES.BSE"},
 {name:"BANK NIFTY",symbol:"BANKBEES.BSE"}
];

// ================= API =================
async function getLivePrices(symbol){
  const url=`https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${symbol}&interval=5min&apikey=${API_KEY}`;
  const r=await fetch(url);
  const d=await r.json();
  const s=d["Time Series (5min)"];
  let p=[];
  for(let t in s){
    p.push(parseFloat(s[t]["4. close"]));
    if(p.length>=60) break;
  }
  return p.reverse();
}

// ================= INDICATORS =================
function EMA(period,data){
  let k=2/(period+1),e=data[0];
  for(let i=1;i<data.length;i++)
    e=data[i]*k+e*(1-k);
  return e;
}

function RSI(period,data){
  let g=0,l=0;
  for(let i=data.length-period;i<data.length-1;i++){
    let d=data[i+1]-data[i];
    if(d>=0) g+=d; else l-=d;
  }
  let rs=g/(l||1);
  return 100-(100/(1+rs));
}

// ================= TRADE LOGIC =================
function checkTrade(price){
  if(!activeTrade) return;

  if(activeTrade.signal==="BUY"){
    if(price>=activeTrade.target) closeTrade("WIN");
    else if(price<=activeTrade.sl) closeTrade("LOSS");
  }

  if(activeTrade.signal==="SELL"){
    if(price<=activeTrade.target) closeTrade("WIN");
    else if(price>=activeTrade.sl) closeTrade("LOSS");
  }
}

function closeTrade(result){
  totalTrades++;
  if(result==="WIN") winTrades++;

  history.unshift({
    time:new Date().toLocaleTimeString(),
    ...activeTrade,
    result
  });

  if(history.length>6) history.pop();
  activeTrade=null;
  renderStats();
}

// ================= MAIN ANALYZE =================
async function analyze(){
  const symbol=document.getElementById("stock").value;
  const prices=await getLivePrices(symbol);

  const price=prices[prices.length-1];
  const ema20=EMA(20,prices);
  const ema50=EMA(50,prices);
  const rsi=RSI(14,prices);

  let signal="WAIT";
  if(ema20>ema50 && rsi>45) signal="BUY";
  else if(ema20<ema50 && rsi<55) signal="SELL";

  checkTrade(price);

  if(!activeTrade && signal!=="WAIT"){
    let target,sl;
    if(signal==="BUY"){
      target=price*(1+TARGET_PCT);
      sl=price*(1-SL_PCT);
    }else{
      target=price*(1-TARGET_PCT);
      sl=price*(1+SL_PCT);
    }
    activeTrade={signal,entry:price,target,sl};
  }

  document.getElementById("signal").innerHTML=signal;
  document.getElementById("signal").className=
    signal==="BUY"?"buy":signal==="SELL"?"sell":"wait";

  document.getElementById("info").innerHTML=
    `Price ${price.toFixed(2)} | EMA20 ${ema20.toFixed(2)} | EMA50 ${ema50.toFixed(2)} | RSI ${rsi.toFixed(1)}`;

  renderStats();
}

// ================= RENDER =================
function renderStats(){
  let acc=totalTrades?((winTrades/totalTrades)*100).toFixed(2):0;
  let html=`<h4>ðŸ“Š Performance</h4>
  Trades: ${totalTrades}<br>
  Wins: ${winTrades}<br>
  Accuracy: <b>${acc}%</b><hr/>`;

  if(activeTrade){
    html+=`ðŸ”µ OPEN ${activeTrade.signal}<br>
    Entry ${activeTrade.entry.toFixed(2)} |
    Target ${activeTrade.target.toFixed(2)} |
    SL ${activeTrade.sl.toFixed(2)}<hr/>`;
  }

  history.forEach(h=>{
    html+=`${h.time} ${h.signal} â†’ 
    <span style="color:${h.result==="WIN"?"#22c55e":"#ef4444"}">
    ${h.result}</span><br>`;
  });

  document.getElementById("history").innerHTML=html;
}

// ================= SCANNERS =================
async function scanStocks(){
  let html="<h4>ðŸ“Š Stock Scanner</h4>";
  for(let s of STOCKS){
    const p=await getLivePrices(s.symbol);
    const r=RSI(14,p);
    const e20=EMA(20,p),e50=EMA(50,p);
    let sig="WAIT",c="#eab308";
    if(e20>e50 && r>45){sig="BUY";c="#22c55e";}
    else if(e20<e50 && r<55){sig="SELL";c="#ef4444";}
    html+=`<div class="card"><b>${s.name}</b>
    <span style="color:${c}"> ${sig}</span>
    <small> RSI ${r.toFixed(1)}</small></div>`;
  }
  document.getElementById("scanner").innerHTML=html;
}

async function scanIndexes(){
  let html="<h4>ðŸ“ˆ Index Scanner</h4>";
  for(let i of INDEXES){
    const p=await getLivePrices(i.symbol);
    const r=RSI(14,p);
    const e20=EMA(20,p),e50=EMA(50,p);
    let sig="SIDEWAYS",c="#eab308";
    if(e20>e50 && r>50){sig="BULLISH";c="#22c55e";}
    else if(e20<e50 && r<50){sig="BEARISH";c="#ef4444";}
    html+=`<div class="card"><b>${i.name}</b><br>
    <span style="color:${c}">${sig}</span>
    <small> RSI ${r.toFixed(1)}</small></div>`;
  }
  document.getElementById("indexScanner").innerHTML=html;
}

// ================= AUTO =================
window.onload=()=>{
  analyze();
  scanStocks();
  scanIndexes();
};

setInterval(()=>{
  analyze();
  scanStocks();
  scanIndexes();
},300000);
</script>

</body>
</html>